<!DOCTYPE html>
<html>
<head>
    <title>Socket.io 測試</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin: 10px 0; }
        input, button { margin: 5px; padding: 8px; }
        .message { margin: 5px 0; padding: 5px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>聊天測試</h1>
    
    <div>
        <input id="token" type="text" placeholder="貼上你的 JWT token" style="width: 500px;">
        <button onclick="connect()">連接</button>
        <button onclick="disconnect()">斷開</button>
    </div>
    
    <div id="status">未連接</div>
    
    <div>
        <input id="roomId" type="number" placeholder="房間ID" value="1">
        <button onclick="joinRoom()">加入房間</button>
    </div>
    
    <div>
        <input id="messageText" type="text" placeholder="輸入訊息">
        <button onclick="sendMessage()">發送訊息</button>
    </div>
    
    <div id="messages"></div>

    <script>
        let socket = null;
        
        function connect() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('請輸入 token');
                return;
            }
            
            socket = io('http://localhost:3000', { auth: { token } });
            
            socket.on('connect', () => {
                document.getElementById('status').textContent = '已連接';
                addMessage('系統', '連接成功');
            });
            
            socket.on('disconnect', () => {
                document.getElementById('status').textContent = '已斷開';
                addMessage('系統', '連接斷開');
            });
            
            socket.on('joined_room', (data) => {
                addMessage('系統', '成功加入房間: ' + JSON.stringify(data));
            });
            
            socket.on('new_message', (data) => {
                addMessage('新訊息', JSON.stringify(data));
            });
            
            socket.on('error', (error) => {
                addMessage('錯誤', JSON.stringify(error));
            });
        }
        
        function disconnect() {
            if (socket) {
                socket.disconnect();
            }
        }
        
        function joinRoom() {
            const roomId = document.getElementById('roomId').value;
            if (socket && roomId) {
                socket.emit('join_room', { roomId: parseInt(roomId) });
                addMessage('發送', '嘗試加入房間 ' + roomId);
            }
        }
        
        function sendMessage() {
            const roomId = document.getElementById('roomId').value;
            const message = document.getElementById('messageText').value;
            if (socket && roomId && message) {
                socket.emit('send_message', {
                    roomId: parseInt(roomId),
                    content: message,
                    messageType: 'text'
                });
                addMessage('發送', message);
                document.getElementById('messageText').value = '';
            }
        }
        
        function addMessage(type, content) {
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `<strong>${type}:</strong> ${content}`;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>